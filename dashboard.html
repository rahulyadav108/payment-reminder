<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Hisab Kitab Dashboard</title>
  <link rel="stylesheet" href="style.css">
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
</head>
<body>
  <div class="dashboard-container">
    <header>
      <h2>ğŸ“Š Hisab Kitab Dashboard</h2>
      <nav>
        <a href="profile.html">ğŸ‘¤</a>
        <a href="notifications.html">ğŸ””</a>
        <a href="subscription.html">ğŸ’³</a>
      </nav>
    </header>

    <main>
      <section class="overview">
        <h3>ğŸ“Œ Overview</h3>
        <p><strong>Total Customers Added:</strong> <span id="totalCustomers">0</span></p>
        <p><strong>Messages Sent:</strong> <span id="totalMessages">0</span></p>
      </section>

      <section class="links">
        <a href="add-debtor.html" class="nav-card">â• Add Debtor</a>
        <a href="vendor-hisab.html" class="nav-card">ğŸ“’ Vendor Hisab</a>
      </section>
    </main>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyD4rUpC-Y7m1hGwKydLjTN4hnH4PUejF-0",
      authDomain: "paymentloo.firebaseapp.com",
      databaseURL: "https://paymentloo-default-rtdb.firebaseio.com",
      projectId: "paymentloo",
      storageBucket: "paymentloo.appspot.com",
      messagingSenderId: "678382986235",
      appId: "1:678382986235:web:14d671959c28ec800a215e"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    function updateStats() {
      const user = firebase.auth().currentUser;
      if (!user) return;

      db.ref(`users/${user.uid}/customers`).once('value', snapshot => {
        let total = 0, messages = 0;
        snapshot.forEach(child => {
          total++;
          const data = child.val();
          if (data.messageSent) messages++;
        });

        document.getElementById('totalCustomers').innerText = total;
        document.getElementById('totalMessages').innerText = messages;
      });
    }

    firebase.auth().onAuthStateChanged(user => {
      if (user) {
        updateStats();
      } else {
        window.location.href = 'login.html';
      }
    });
  </script>
</body>
</html>
